<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω ƒë∆°n h√†ng</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="container mt-4">

    <!-- üîπ Ti√™u ƒë·ªÅ -->
    <h2 class="text-center text-primary">QU·∫¢N L√ù ƒê∆†N H√ÄNG</h2>

    <!-- üîπ Menu l·ªçc tr·∫°ng th√°i -->
    <div class="d-flex mb-3">
        <button class="btn btn-outline-primary mx-1 filter-btn" data-status="all">T·∫•t c·∫£</button>
        <button class="btn btn-outline-warning mx-1 filter-btn" data-status="pending">Ch·ªù x·ª≠ l√Ω</button>
        <button class="btn btn-outline-info mx-1 filter-btn" data-status="processing">ƒêang x·ª≠ l√Ω</button>
        <button class="btn btn-outline-success mx-1 filter-btn" data-status="completed">Ho√†n th√†nh</button>
        <button class="btn btn-outline-danger mx-1 filter-btn" data-status="canceled">H·ªßy ƒë∆°n</button>
    </div>

    <!-- üîπ Thanh t√¨m ki·∫øm -->
    <div class="input-group mb-3">
        <input type="text" id="search-input" class="form-control" placeholder="T√¨m ki·∫øm ƒë∆°n h√†ng...">
        <button class="btn btn-outline-secondary" id="search-btn">üîç</button>
    </div>

    <!-- üîπ B·∫£ng danh s√°ch ƒë∆°n h√†ng -->
    <table class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>Ng√†y g·ª≠i</th>
                <th>ID</th>
                <th>·∫¢nh CK</th>
                <th>Th√¥ng tin order</th>
                <th>·∫¢nh g√≥i</th>
                <th>Gi√°</th>
                <th>Tr·∫°ng th√°i</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody id="order-list">
            <% orders.forEach(order => { %>
            <tr data-status="<%= order.status %>">
                <td><%= order.date %></td>
                <td><%= order.id %></td>
                <td>
                    <% if (order.paymentImage) { %>
                        <img src="<%= order.paymentImage %>" width="50">
                    <% } else { %>
                        Kh√¥ng c√≥ ·∫£nh
                    <% } %>
                </td>
                <td>
                    Ph∆∞∆°ng th·ª©c: <%= order.method %><br>
                    SƒêT: <%= order.phone %><br>
                    TK: <%= order.account %><br>
                    NV: <%= order.character %>
                </td>
                <td><img src="<%= order.productImage %>" width="50"></td>
                <td><%= order.price %> ƒë</td>
                <td>
                    <select class="form-select status-select" data-id="<%= order.id %>">
                        <option value="pending" <%= order.status === "pending" ? "selected" : "" %>>Ch·ªù x·ª≠ l√Ω</option>
                        <option value="processing" <%= order.status === "processing" ? "selected" : "" %>>ƒêang x·ª≠ l√Ω</option>
                        <option value="completed" <%= order.status === "completed" ? "selected" : "" %>>Ho√†n th√†nh</option>
                        <option value="canceled" <%= order.status === "canceled" ? "selected" : "" %>>H·ªßy ƒë∆°n</option>
                    </select>
                </td>
                <td>
                    <button class="btn btn-primary btn-sm update-status" data-id="<%= order.id %>">C·∫≠p nh·∫≠t</button>
                </td>
            </tr>
            <% }) %>
        </tbody>
    </table>

    <script>
        $(document).ready(function () {
            // L·ªçc ƒë∆°n h√†ng theo tr·∫°ng th√°i
            $(".filter-btn").click(function () {
                let status = $(this).data("status");
                if (status === "all") {
                    $("#order-list tr").show();
                } else {
                    $("#order-list tr").hide();
                    $("#order-list tr[data-status='" + status + "']").show();
                }
            });

            // T√¨m ki·∫øm ƒë∆°n h√†ng
            $("#search-btn").click(function () {
                let keyword = $("#search-input").val().toLowerCase();
                $("#order-list tr").each(function () {
                    let text = $(this).text().toLowerCase();
                    $(this).toggle(text.includes(keyword));
                });
            });

            // C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng
            $(".update-status").click(function () {
                let row = $(this).closest("tr");
                let orderId = $(this).data("id");
                let newStatus = row.find(".status-select").val();

                $.post("/update-order-status", { id: orderId, status: newStatus }, function (response) {
                    if (response.success) {
                        row.attr("data-status", newStatus);
                        alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!");
                    } else {
                        alert("C·∫≠p nh·∫≠t th·∫•t b·∫°i!");
                    }
                });
            });
        });
    </script>

</body>
</html>
